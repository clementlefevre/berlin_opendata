---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(tidyverse)
```

```{r}

all_files <- list.files('data/names/')

read_names_files <- function(file.name){
  print(file.name)
  df <- read.csv(paste('data/names/',file.name,sep=''),sep=';')
  df$position <- NULL
  df$viertel <- str_match(file.name, "_(.*?)\\.")[2]
  df$year <- word(file.name,1,sep = "\\_")
  return (df %>% select(year,everything()))
}

df <- read_names_files(all_files[1])

df <- do.call(`rbind`,lapply(all_files, read_names_files))
df$vorname <- tolower(df$vorname)
df$viertel <- tolower(df$viertel)
df <- df %>% mutate_at('vorname', funs(iconv(., to='ASCII//TRANSLIT')))

```

```{r}
## Add count for all Berlin
df.berlin <- df  %>% group_by(vorname,geschlecht,year) %>% summarise(anzahl = sum(anzahl))
df.berlin$viertel <- 'berlin'
df.all <- bind_rows(df,df.berlin)


write.csv(df.all,'data/all_names_year_viertel.csv')
```

